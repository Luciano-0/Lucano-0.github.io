<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo16.png">
  <link rel="mask-icon" href="/images/mylogo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Times New Roman:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"luciano-0.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":true,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="1. 引言游戏中的人工智能指拥有决策能力的智能体，会对环境的改变作出相应的决策。其中，移动是智能体最基本也是最通用的行为。 智能体的移动可以分为三个环节：  行为选择：该部分负责选定目标、制定计划。它来告诉我们“到这来”和“做好A、B，然后做C”。 操控：该环节负责计算运动数据，根据选择的行为计算得到一个操控力，它决定智能体往哪儿移动以及如何快速移动。 移动：主要表现智能体运动的机械因素，即控制智">
<meta property="og:type" content="article">
<meta property="og:title" content="游戏人工智能的移动">
<meta property="og:url" content="https://luciano-0.github.io/2022/01/23/tech/AIMovement/index.html">
<meta property="og:site_name" content="酒时柒">
<meta property="og:description" content="1. 引言游戏中的人工智能指拥有决策能力的智能体，会对环境的改变作出相应的决策。其中，移动是智能体最基本也是最通用的行为。 智能体的移动可以分为三个环节：  行为选择：该部分负责选定目标、制定计划。它来告诉我们“到这来”和“做好A、B，然后做C”。 操控：该环节负责计算运动数据，根据选择的行为计算得到一个操控力，它决定智能体往哪儿移动以及如何快速移动。 移动：主要表现智能体运动的机械因素，即控制智">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片1.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-db1cb3b24cef.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片3.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-50d90fbb5e2c.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片5.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-7bf95b052761.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-8eb03b0523a4.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片4.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-50c0901241f0.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-05e9c5abac4a.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片7.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片8.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片9.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片10.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/æªå½å.gif">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片11.png">
<meta property="og:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片12.png">
<meta property="article:published_time" content="2022-01-23T13:02:42.000Z">
<meta property="article:modified_time" content="2022-01-23T13:05:36.610Z">
<meta property="article:author" content="酒时柒">
<meta property="article:tag" content="AI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://luciano-0.github.io/Users/luciano/Library/Mobile%20Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片1.png">

<link rel="canonical" href="https://luciano-0.github.io/2022/01/23/tech/AIMovement/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>游戏人工智能的移动 | 酒时柒</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">酒时柒</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-关于">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-技术">

    <a href="/tech/" rel="section"><i class="fa fa-code fa-fw"></i>技术</a>

  </li>
        <li class="menu-item menu-item-摄影">

    <a href="/photos/" rel="section"><i class="fa fa-camera fa-fw"></i>摄影</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://luciano-0.github.io/2022/01/23/tech/AIMovement/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="酒时柒">
      <meta itemprop="description" content="梦想是拥有一套三块五的海景房">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="酒时柒">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          游戏人工智能的移动
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-01-23 21:02:42 / 修改时间：21:05:36" itemprop="dateCreated datePublished" datetime="2022-01-23T21:02:42+08:00">2022-01-23</time>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="1-引言"><a href="#1-引言" class="headerlink" title="1. 引言"></a>1. 引言</h2><p>游戏中的人工智能指拥有决策能力的智能体，会对环境的改变作出相应的决策。其中，移动是智能体最基本也是最通用的行为。</p>
<p>智能体的移动可以分为三个环节：</p>
<ul>
<li><strong>行为选择</strong>：该部分负责选定目标、制定计划。它来告诉我们“到这来”和“做好A、B，然后做C”。</li>
<li><strong>操控</strong>：该环节负责计算运动数据，根据选择的行为计算得到一个操控力，它决定智能体往哪儿移动以及如何快速移动。</li>
<li><strong>移动</strong>：主要表现智能体运动的机械因素，即控制智能体的移动方式。比如，人和汽车有不同的移动方式，虽然他们具有同样的意向，收到相同的操控力，但是最终的移动表现是完全不同的。</li>
</ul>
<a id="more"></a>

<h2 id="2-模型建立：MovingEntity"><a href="#2-模型建立：MovingEntity" class="headerlink" title="2. 模型建立：MovingEntity"></a>2. 模型建立：MovingEntity</h2><p>在开始之前首先建立一个最基本的移动智能体的模型，即确定下移动的环节。</p>
<p>通常一个移动的智能体具有以下属性：</p>
<ul>
<li>位置：position</li>
<li>方向：rotation</li>
<li>质量：mass</li>
<li>速度：velocity</li>
<li>操控力：force</li>
<li>最大速度：maxSpeed</li>
<li>最大操控力：maxForce</li>
<li>最大转动速率：maxTurnRate</li>
</ul>
<p>MovingEntity类中需要有Update()方法来每帧更新智能体的物理状态，代码如下：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (mass == <span class="number">0</span>) mass = <span class="number">1</span>;</span><br><span class="line">		Velocity = Force / mass * Time.deltaTime + Velocity;</span><br><span class="line">		<span class="keyword">if</span> (Velocity.sqrMagnitude &gt; maxSpeed * maxSpeed)</span><br><span class="line">      	Velocity = Velocity.normalized * maxSpeed;</span><br><span class="line">		transform.position += Velocity * Time.deltaTime;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">var</span> fn = Velocity.normalized;</span><br><span class="line">		<span class="keyword">var</span> vn = transform.forward;</span><br><span class="line">		<span class="keyword">if</span> (fn == <span class="keyword">default</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">var</span> angle = Vector3.Angle(fn, vn);</span><br><span class="line">		<span class="keyword">if</span> (angle &lt; <span class="number">5</span>) <span class="keyword">return</span>;</span><br><span class="line">		<span class="keyword">var</span> axis = Vector3.Cross(fn, vn);</span><br><span class="line">		transform.Rotate(axis, -maxTurnRate * Time.deltaTime, Space.World);</span><br><span class="line">		transform.Rotate(transform.forward * rotationSpeed * Time.deltaTime, Space.World);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="3-个体行为"><a href="#3-个体行为" class="headerlink" title="3. 个体行为"></a>3. 个体行为</h2><p>接下来是最关键的部分，根据不同的行为计算需要施加的操控力。在分析各种行为过程中，我们总是遵循一个公式：</p>
<ul>
<li><strong>操控力 = 预期速度 - 当前速度</strong></li>
</ul>
<h3 id="3-1-Seek（靠近）"><a href="#3-1-Seek（靠近）" class="headerlink" title="3.1 Seek（靠近）"></a>3.1 Seek（靠近）</h3><ul>
<li>预期速度：这个速度为智能体在理想状态下到达目标位置所需的速度，方向为智能体到目标位置的向量，大小为最大速度。</li>
<li>所需操控力：方向为 (预期速度-当前速度)，大小为最大操控力大小。</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片1.png" alt="图片1" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Seek</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, Vector3 target</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">		<span class="keyword">var</span> dis = target - entity.transform.position;</span><br><span class="line">		<span class="keyword">var</span> needVelocity = dis.normalized * entity.maxSpeed;</span><br><span class="line">		<span class="keyword">var</span> deltaVelocity = needVelocity - entity.Velocity;</span><br><span class="line">		<span class="keyword">return</span> deltaVelocity.normalized * entity.maxForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-db1cb3b24cef.gif" alt="ezgif-7-db1cb3b24cef" style="zoom:50%;" />

<h3 id="3-2-Flee（远离）"><a href="#3-2-Flee（远离）" class="headerlink" title="3.2 Flee（远离）"></a>3.2 Flee（远离）</h3><ul>
<li>预期速度与Seek正好相反。</li>
<li>可以进行适当调整，如当目标进入到一定范围内才产生远离的操控力。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Flee</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, Vector3 target, <span class="keyword">float</span> keepDistance</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> pos = entity.transform.position;</span><br><span class="line">    <span class="keyword">if</span> ((pos - target).sqrMagnitude &gt;= keepDistance * keepDistance)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (entity.Velocity.sqrMagnitude &lt; <span class="number">0.1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            entity.Stop();</span><br><span class="line">            <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> entity.Velocity.normalized * <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> needVelocity = (pos - target).normalized * entity.maxSpeed;</span><br><span class="line">    <span class="keyword">var</span> deltaVelocity = needVelocity - entity.Velocity;</span><br><span class="line">    <span class="keyword">return</span> deltaVelocity.normalized * entity.maxForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-3-Arrive（抵达）"><a href="#3-3-Arrive（抵达）" class="headerlink" title="3.3 Arrive（抵达）"></a>3.3 Arrive（抵达）</h3><ul>
<li>与Seek不同，Arrive可以实现减速并停在目标位置。当与目标距离大于阈值时算法与Seek相同，当距离小于阈值时需要进行减速。</li>
<li>进入阈值时的预期速度：方向为智能体到目标位置的向量，大小与距离的1/2次幂成正比。</li>
<li>所需操控力：方向为 (预期速度-当前速度)，大小为最大操控力大小。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Arrive</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, Vector3 target, <span class="keyword">float</span> slowDownDis = <span class="number">10</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> toTarget = target - entity.transform.position;</span><br><span class="line">    <span class="keyword">var</span> dis = toTarget.magnitude;</span><br><span class="line">    <span class="keyword">if</span> (dis &gt; slowDownDis) <span class="keyword">return</span> entity.Seek(target);</span><br><span class="line">    <span class="keyword">if</span> (dis &gt; <span class="number">0.1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">var</span> needSpeed = (<span class="keyword">float</span>)Math.Sqrt(<span class="number">2</span> * entity.maxForce / entity.mass * dis);</span><br><span class="line">        <span class="keyword">var</span> needVelocity = toTarget.normalized * needSpeed;</span><br><span class="line">        <span class="keyword">return</span> (needVelocity - entity.Velocity).normalized * entity.maxForce;</span><br><span class="line">    &#125;</span><br><span class="line">    entity.Stop();</span><br><span class="line">    <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>![ezgif-7-97cf6dcdebbf](/Users/luciano/Library/Mobile Documents/com<del>apple</del>CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-97cf6dcdebbf.gif)</p>
<h3 id="3-4-Pursuit（追逐）"><a href="#3-4-Pursuit（追逐）" class="headerlink" title="3.4 Pursuit（追逐）"></a>3.4 Pursuit（追逐）</h3><ul>
<li>在追逐目标时，我们通常不会直接向目标的当前位置跑，而是会预测目标未来的位置，向预测的位置跑，期间不断通过调整来缩短差距。</li>
<li>预测目标位置的算法可以变得很复杂，但我们可以做个折衷的选择，在保证足够的精度的同时又不会消耗过多的性能。</li>
<li>我们主要要计算的就是追上的位置距离当前目标的位置有多远，这个距离与当前自己与目标的距离成正比，与目标速度的二次幂成正比，与自己速度的二次幂成反比。</li>
<li>此外，需要考虑一种特殊情况，当目标朝向自己跑时，这时候不需要预测位置，直接朝向目标当前位置跑就能追上了。</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片3.png" alt="图片3" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Pursuit</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, MovingEntity target, <span class="keyword">float</span> keepDistance = <span class="number">0.1f</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = entity.transform.position - target.transform.position;</span><br><span class="line">    <span class="comment">// 追到目标后停止</span></span><br><span class="line">    <span class="keyword">if</span> (dir.sqrMagnitude &lt;= keepDistance * keepDistance)</span><br><span class="line">    &#123;</span><br><span class="line">        entity.Stop();</span><br><span class="line">        <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当目标朝向自己时，直接向目标当前位置移动</span></span><br><span class="line">    <span class="keyword">if</span> (Vector3.Angle(dir, target.transform.forward) &lt; <span class="number">20</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> Seek(entity, target.transform.position);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//当目标在向其他方向移动时，需要预判目标一段时间后的位置。</span></span><br><span class="line">    <span class="keyword">var</span> tarSpeed = target.Velocity.magnitude;</span><br><span class="line">    <span class="keyword">var</span> lookAheadDis = dir.magnitude * tarSpeed / entity.maxSpeed;</span><br><span class="line">    <span class="keyword">var</span> tarPos = target.transform.position + target.Velocity.normalized * lookAheadDis;</span><br><span class="line">    <span class="keyword">return</span> entity.Seek(tarPos);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-50d90fbb5e2c.gif" alt="ezgif-7-50d90fbb5e2c" style="zoom:50%;" />

<h3 id="3-5-Evade-逃避"><a href="#3-5-Evade-逃避" class="headerlink" title="3.5 Evade(逃避)"></a>3.5 Evade(逃避)</h3><ul>
<li>和追逐类似，只是方向相反，且不用检查是否正面。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Evade</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, MovingEntity target, <span class="keyword">float</span> keepDistance</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = entity.transform.position - target.transform.position;</span><br><span class="line">    <span class="keyword">var</span> tarSpeed = target.Velocity.magnitude;</span><br><span class="line">    <span class="keyword">var</span> lookAheadDis = dir.magnitude * tarSpeed / entity.maxSpeed;</span><br><span class="line">    <span class="keyword">var</span> tarPos = target.transform.position + target.Velocity.normalized * lookAheadDis;</span><br><span class="line">    <span class="keyword">return</span> entity.Flee(tarPos, keepDistance);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3-6-Wander（徘徊）"><a href="#3-6-Wander（徘徊）" class="headerlink" title="3.6 Wander（徘徊）"></a>3.6 Wander（徘徊）</h3><ul>
<li><strong>定义：</strong>产生一个操控力，使智能体在场景内随机移动。</li>
<li><strong>两个错误（欠优）的思路：</strong>1.使用普通的随机算法每帧都计算一个随机的驱动力：因为随机算法取到的随机数不是连续的，所以无法实现持续的驱动力变化，会产生抖动。2.使用Perlin噪声，可以产生连续的转弯，但是性能开销较大。</li>
<li><strong>Reynolds的解决方案：</strong>在智能体前端突出一个圆圈，目标被限制在该圆圈上。每帧给目标添加一个随机的位移，来产生一个随机但连续的操控力。通过控制圆圈的半径、圆圈到智能体的距离以及每帧随机位移的大小，就能产生各种形式的随机运动。</li>
<li>三维空间中，智能体的目标就改成限制在一个球体上。</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片5.png" alt="图片5" style="zoom:50%;" />

<p>![图片6](/Users/luciano/Library/Mobile Documents/com<del>apple</del>CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片6.png)</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Wander</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, <span class="keyword">float</span> wanderRadius, <span class="keyword">float</span> wanderDistance, <span class="keyword">float</span> wanderJitter,</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="keyword">bool</span> limit = <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    entity.WanderTarget += <span class="keyword">new</span> Vector3(Random.Range(<span class="number">-1</span> * wanderJitter, wanderJitter),</span><br><span class="line">        Random.Range(<span class="number">-1</span> * wanderJitter, wanderJitter), <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">var</span> limitParam = limit ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">var</span> wanderCirclePoint = entity.Velocity.normalized * wanderDistance + entity.transform.position * limitParam;</span><br><span class="line">    entity.WanderTarget = wanderCirclePoint + wanderRadius * (entity.WanderTarget - wanderCirclePoint).normalized;</span><br><span class="line">    <span class="keyword">return</span> entity.Seek(entity.WanderTarget);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-7bf95b052761.gif" alt="ezgif-7-7bf95b052761" style="zoom:67%;" />

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-8eb03b0523a4.gif" alt="ezgif-7-8eb03b0523a4" style="zoom:67%;" />

<h3 id="3-7-Interpose（插入）"><a href="#3-7-Interpose（插入）" class="headerlink" title="3.7 Interpose（插入）"></a>3.7 Interpose（插入）</h3><ul>
<li><strong>定义：</strong>产生一个操控力，控制智能体移动到两个智能体的中点，可以用于运动员截球，保镖保护老板等行为。</li>
<li><strong>实现方法：</strong><ul>
<li>计算智能体移动到当前两个目标连线中点需要的时间t。</li>
<li>计算t时间后两个目标所在的位置。</li>
<li>连线中点就是智能体的目标位置，使用Arrive移向它。</li>
</ul>
</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片4.png" alt="图片4" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Interpose</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, MovingEntity targetA, MovingEntity targetB</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> targetAPos = targetA.transform.position;</span><br><span class="line">    <span class="keyword">var</span> targetBPos = targetB.transform.position;</span><br><span class="line">    <span class="keyword">var</span> centerNow = (targetAPos + targetBPos) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">var</span> time = (entity.transform.position - centerNow).magnitude / entity.maxSpeed;</span><br><span class="line">    <span class="keyword">var</span> targetAPosPre = targetAPos + targetA.Velocity * time;</span><br><span class="line">    <span class="keyword">var</span> targetBPosPre = targetBPos + targetB.Velocity * time;</span><br><span class="line">    <span class="keyword">return</span> entity.Arrive((targetAPosPre + targetBPosPre) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-50c0901241f0.gif" alt="ezgif-7-50c0901241f0" style="zoom: 67%;" />

<h3 id="3-8-Offset-Pursuit（保持一定偏移的追逐）"><a href="#3-8-Offset-Pursuit（保持一定偏移的追逐）" class="headerlink" title="3.8 Offset Pursuit（保持一定偏移的追逐）"></a>3.8 Offset Pursuit（保持一定偏移的追逐）</h3><ul>
<li><strong>定义：</strong>在追逐的同时保持智能体与目标之间有一个指定的偏移。可用于体育比赛中的盯防、实现战斗编队、空中飞船对接等。</li>
<li><strong>实现思路：</strong>与追逐类似，需要预测下一个带偏移的目标位置，然后用Arrive接近该位置（不能用Seek）。</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">OffsetPursuit</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, MovingEntity target, Vector3 offset</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> dir = entity.transform.position - target.transform.position;</span><br><span class="line">    <span class="keyword">var</span> tarSpeed = target.Velocity.magnitude;</span><br><span class="line">    <span class="keyword">var</span> lookAheadDis = dir.magnitude * tarSpeed / entity.maxSpeed;</span><br><span class="line">    <span class="keyword">var</span> tarPos = target.transform.position + target.Velocity.normalized * lookAheadDis +</span><br><span class="line">                 target.transform.TransformVector(offset);</span><br><span class="line">    <span class="keyword">return</span> entity.Arrive(tarPos, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/ezgif-7-05e9c5abac4a.gif" alt="ezgif-7-05e9c5abac4a" style="zoom: 67%;" />



<h2 id="4-群体行为"><a href="#4-群体行为" class="headerlink" title="4. 群体行为"></a>4. 群体行为</h2><ul>
<li>在群组中，通常个体的感知范围是有限的，因此每个智能体都有邻域的概念，只有在距离自己一定范围内的智能体才能感知到。这个数据可以以列表的形式存在MovingEntity中，在每一帧去更新这个列表。 </li>
<li>更进一步地，可以增加可视域的限制，智能体只能看见一定视角范围内的其他智能体，来达到更真实的模拟。 </li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片7.png" alt="图片7" style="zoom:50%;" />

<h3 id="4-1-Separation（分离）"><a href="#4-1-Separation（分离）" class="headerlink" title="4.1 Separation（分离）"></a>4.1 Separation（分离）</h3><ul>
<li><strong>定义：</strong>产生一个操控力，使得智能体远离临近的智能体，且这个力的大小反比于两个智能体之间的距离。</li>
<li><strong>结合：</strong>分离可与其他个体行为结合，形成各种群体行为，如群体追逐、群体靠近、群体远离等。</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片8.png" alt="图片8" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Separate</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, List&lt;MovingEntity&gt; teammate, <span class="keyword">float</span> desiredSeparation = <span class="number">2</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> force = Vector3.zero;</span><br><span class="line">    Vector3 dir;</span><br><span class="line">    <span class="keyword">float</span> dis;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> mv <span class="keyword">in</span> teammate)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mv == entity) <span class="keyword">continue</span>;</span><br><span class="line">        dir = entity.transform.position - mv.transform.position;</span><br><span class="line">        dis = dir.magnitude &gt; <span class="number">0.1f</span> ? dir.magnitude : <span class="number">0.1f</span>;</span><br><span class="line">        <span class="keyword">if</span> (dis &lt;= desiredSeparation)</span><br><span class="line">        &#123;</span><br><span class="line">            force += dir.normalized / dis;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count == <span class="number">0</span>) <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">    <span class="keyword">return</span> force.normalized * entity.maxForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-2-Alignment（队列）"><a href="#4-2-Alignment（队列）" class="headerlink" title="4.2 Alignment（队列）"></a>4.2 Alignment（队列）</h3><ul>
<li><strong>定义：</strong>智能体企图与邻域中的智能体保持一致的方向。</li>
<li><strong>预期速度：</strong>邻域中所有智能体的平均速度。 </li>
<li>可用于模拟马路上汽车的运动</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片9.png" alt="图片9" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Align</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, List&lt;MovingEntity&gt; teammate, <span class="keyword">float</span> neighborDist = <span class="number">10</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> needVelocity = Vector3.zero;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> mv <span class="keyword">in</span> teammate)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mv == entity) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> ((entity.transform.position - mv.transform.position).sqrMagnitude &lt;= neighborDist * neighborDist)</span><br><span class="line">        &#123;</span><br><span class="line">            needVelocity += mv.Velocity;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">    needVelocity /= count;</span><br><span class="line">    <span class="keyword">return</span> (needVelocity - entity.Velocity).normalized * entity.maxForce;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-Cohesion（聚集）"><a href="#4-3-Cohesion（聚集）" class="headerlink" title="4.3 Cohesion（聚集）"></a>4.3 Cohesion（聚集）</h3><ul>
<li><strong>定义：</strong>智能体试图朝向邻域中所有智能体的质心移动。</li>
<li><strong>实现思路：</strong>求邻域的质心并靠近（Seek）。 </li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片10.png" alt="图片10" style="zoom:50%;" />

<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Vector3 <span class="title">Cohesion</span>(<span class="params"><span class="keyword">this</span> MovingEntity entity, List&lt;MovingEntity&gt; teammate, <span class="keyword">float</span> neighborDist = <span class="number">10</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> center = Vector3.zero;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">var</span> mv <span class="keyword">in</span> teammate)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (mv == entity) <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span> ((entity.transform.position - mv.transform.position).sqrMagnitude &lt;= neighborDist * neighborDist)</span><br><span class="line">        &#123;</span><br><span class="line">            center += mv.Velocity;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (count &lt;= <span class="number">0</span>) <span class="keyword">return</span> Vector3.zero;</span><br><span class="line">    center /= count;</span><br><span class="line">    <span class="keyword">return</span> entity.Seek(center);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-4-Flocking（群集）"><a href="#4-4-Flocking（群集）" class="headerlink" title="4.4 Flocking（群集）"></a>4.4 Flocking（群集）</h3><ul>
<li><strong>鸟群算法（Boids）：</strong>Reynolds提出将分离、队列、聚集三种群体行为以一定权重组合，就能模拟各种群集的移动，如：鸟群、鱼群、羊群等。</li>
<li><strong>特点：</strong>群集不需要任何控制中心或Leader就能实现自发的移动，每个单元都是平等的，受到整体的影响，同时也会影响整体。 </li>
<li>在此基础上可以加入Wander或Seek，保证单位掉队时不会停下。</li>
<li><strong>扩展：</strong>为了达到更自然的模拟效果，可以用Perlin噪声生成权重，使分离、队列、聚集三种行为的权重随着时间变化。</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/æªå½å.gif" alt="æªå½å" style="zoom:150%;" />



<h2 id="5-组合操控行为"><a href="#5-组合操控行为" class="headerlink" title="5. 组合操控行为"></a>5. 组合操控行为</h2><h3 id="5-1-带优先级的加权截断总和"><a href="#5-1-带优先级的加权截断总和" class="headerlink" title="5.1 带优先级的加权截断总和"></a>5.1 带优先级的加权截断总和</h3><ul>
<li><p>每个行为都有优先级，按照优先级顺序计算操控力。</p>
</li>
<li><p>每一帧有可用操控力的概念。</p>
</li>
<li><p>计算步骤：</p>
<ul>
<li>计算优先级最高的行为的操控力。</li>
</ul>
<ul>
<li>若该操控力已将可用操控力用完，则不进行后续运算，直接执行该操控力。</li>
<li>若还有剩余的操控力，则进行下一个优先级行为的计算，计算结果按照最大操控力和剩余操控力的值两者的较小值截断。</li>
<li>以此类推直到可用操控力用完。</li>
</ul>
</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片11.png" alt="图片11" style="zoom:50%;" />

<h3 id="5-2-带优先级的抖动"><a href="#5-2-带优先级的抖动" class="headerlink" title="5.2 带优先级的抖动"></a>5.2 带优先级的抖动</h3><ul>
<li><p>每个行为都有优先级和执行概率。</p>
</li>
<li><p>计算步骤：</p>
<ul>
<li>根据优先级最高行为的执行概率计算是否需要计算该行为的操控力。</li>
<li>如果要求值而且求出的操控力不为零，则直接执行该行为，不考虑其他行为。</li>
<li>否则继续计算下一优先级的行为，以此类推。</li>
</ul>
</li>
<li><p>适用于不需要非常精确的情形。</p>
</li>
</ul>
<img data-src="/Users/luciano/Library/Mobile Documents/com~apple~CloudDocs/Blog/markdown/游戏人工智能-Movement.assets/图片12.png" alt="图片12" style="zoom:50%;" />

<h2 id="6-优化方法"><a href="#6-优化方法" class="headerlink" title="6. 优化方法"></a>6. 优化方法</h2><ul>
<li>尽量使用距离的平方。</li>
<li>若经常需要计算三角函数，可以建立正余弦查询表。</li>
<li>减少不必要的中间结果变量创建，特别是在循环中。</li>
<li>网格空间分隔<ul>
<li>问题：在群体移动行为相关的算法中，通常每个智能体都需要遍历邻域中的所有智能体，复杂度为O(N2)。</li>
<li>网格空间分隔：将空间分割为若干网格，每个网格维护一个List，储存其中的智能体。每帧开始时根据位置更新所有网格的数据。在具体行为的计算时，每个智能体能根据自己的位置确定处于哪个网格，该网格（或包含相邻网格）下的所有智能体就是自己邻域中的智能体。</li>
<li>复杂度：O(N)</li>
</ul>
</li>
</ul>
<p><strong>参考资料：</strong></p>
<ul>
<li>《游戏人工智能编程案例精粹》第3章：如何创建自治的可移动游戏智能体</li>
<li>《代码本色》第6章：自治智能体</li>
</ul>
<p><strong>Demo地址：</strong><a target="_blank" rel="noopener" href="https://github.com/Luciano-0/AIMovement.git">https://github.com/Luciano-0/AIMovement.git</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"># AI</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/01/22/tech/StateAndDuty/" rel="prev" title="状态模式和职责链模式">
      <i class="fa fa-chevron-left"></i> 状态模式和职责链模式
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">1. 引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%A8%A1%E5%9E%8B%E5%BB%BA%E7%AB%8B%EF%BC%9AMovingEntity"><span class="nav-number">2.</span> <span class="nav-text">2. 模型建立：MovingEntity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E4%B8%AA%E4%BD%93%E8%A1%8C%E4%B8%BA"><span class="nav-number">3.</span> <span class="nav-text">3. 个体行为</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-Seek%EF%BC%88%E9%9D%A0%E8%BF%91%EF%BC%89"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 Seek（靠近）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-Flee%EF%BC%88%E8%BF%9C%E7%A6%BB%EF%BC%89"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 Flee（远离）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-Arrive%EF%BC%88%E6%8A%B5%E8%BE%BE%EF%BC%89"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 Arrive（抵达）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-Pursuit%EF%BC%88%E8%BF%BD%E9%80%90%EF%BC%89"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 Pursuit（追逐）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-Evade-%E9%80%83%E9%81%BF"><span class="nav-number">3.5.</span> <span class="nav-text">3.5 Evade(逃避)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-Wander%EF%BC%88%E5%BE%98%E5%BE%8A%EF%BC%89"><span class="nav-number">3.6.</span> <span class="nav-text">3.6 Wander（徘徊）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-7-Interpose%EF%BC%88%E6%8F%92%E5%85%A5%EF%BC%89"><span class="nav-number">3.7.</span> <span class="nav-text">3.7 Interpose（插入）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-8-Offset-Pursuit%EF%BC%88%E4%BF%9D%E6%8C%81%E4%B8%80%E5%AE%9A%E5%81%8F%E7%A7%BB%E7%9A%84%E8%BF%BD%E9%80%90%EF%BC%89"><span class="nav-number">3.8.</span> <span class="nav-text">3.8 Offset Pursuit（保持一定偏移的追逐）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%BE%A4%E4%BD%93%E8%A1%8C%E4%B8%BA"><span class="nav-number">4.</span> <span class="nav-text">4. 群体行为</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Separation%EF%BC%88%E5%88%86%E7%A6%BB%EF%BC%89"><span class="nav-number">4.1.</span> <span class="nav-text">4.1 Separation（分离）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Alignment%EF%BC%88%E9%98%9F%E5%88%97%EF%BC%89"><span class="nav-number">4.2.</span> <span class="nav-text">4.2 Alignment（队列）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Cohesion%EF%BC%88%E8%81%9A%E9%9B%86%EF%BC%89"><span class="nav-number">4.3.</span> <span class="nav-text">4.3 Cohesion（聚集）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-Flocking%EF%BC%88%E7%BE%A4%E9%9B%86%EF%BC%89"><span class="nav-number">4.4.</span> <span class="nav-text">4.4 Flocking（群集）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%BB%84%E5%90%88%E6%93%8D%E6%8E%A7%E8%A1%8C%E4%B8%BA"><span class="nav-number">5.</span> <span class="nav-text">5. 组合操控行为</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%B8%A6%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E5%8A%A0%E6%9D%83%E6%88%AA%E6%96%AD%E6%80%BB%E5%92%8C"><span class="nav-number">5.1.</span> <span class="nav-text">5.1 带优先级的加权截断总和</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%B8%A6%E4%BC%98%E5%85%88%E7%BA%A7%E7%9A%84%E6%8A%96%E5%8A%A8"><span class="nav-number">5.2.</span> <span class="nav-text">5.2 带优先级的抖动</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95"><span class="nav-number">6.</span> <span class="nav-text">6. 优化方法</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="酒时柒"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">酒时柒</p>
  <div class="site-description" itemprop="description">梦想是拥有一套三块五的海景房</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">24</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/luciano-0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;luciano-0" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:3160102261@zju.edu.cn" title="E-Mail → mailto:3160102261@zju.edu.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">酒时柒</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
